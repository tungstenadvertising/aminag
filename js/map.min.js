function removeOpenPopups(){const e=document.getElementsByClassName("mapboxgl-popup");e[0]&&e[0].remove()}function closePopup(){removeOpenPopups(),removeActiveClass()}function jumpTo(e){map.flyTo({center:e.geometry.coordinates,duration:2e3,zoom:10})}function removeActiveClass(){let e=document.querySelectorAll(".farms-listing-item");e.forEach(e=>e.classList.remove("active"));let t=document.querySelectorAll(".marker");t.forEach(e=>e.classList.remove("active"))}function addMarker(e,t){const o=t,a=document.createElement("div");a.className="marker";const r=document.createElement("div");r.className=`marker-icon ${1==o?"markerEntrance":""}`,r.style.setProperty("--animate-delay",`${100*e.properties.index}ms`),a.insertAdjacentElement("beforeend",r),a.id=`${e.properties.id}`;const s=new mapboxgl.Marker(a),i=new mapboxgl.Popup({offset:45}).setHTML(`\n    <h3>${e.properties.title}</h3>\n    <div class="flex items-center" style="padding: 15px;">\n      <div class="description">\n        <div class="location">${e.properties.location}</div>\n        <div class="crop">Crop: <br> <b>${e.properties.crop}</b></div>\n        <div class="acres">Acres: <br> <b>${e.properties.grossacres}</b></div>\n      </div>\n      <img class="image" width="170" height="130" src=${e.properties.image} />\n    </div>\n  `).on("close",function(){removeActiveClass()}).on("open",function(){a.classList.add("active"),document.getElementById(`farm-listing-item-${e.properties.id}`).classList.add("active")});s.setLngLat(e.geometry.coordinates).setPopup(i).addTo(map),r.addEventListener("mouseenter",({})=>{removeActiveClass(),removeOpenPopups(),s.togglePopup()}),r.addEventListener("mouseleave",({})=>{removeOpenPopups(),s.togglePopup()})}function buildLocationList(e,t){let o=t;farmListingContainer.innerHTML="";let a=document.querySelectorAll(".marker");a.forEach(e=>e.remove());for(const a of e){let e=document.createElement("a");e.className=`farms-listing-item ${1==o?"animate-listing-item":""}`,e.style.setProperty("--animate-delay",`${100*a.properties.index}ms`),e.innerText=`${a.properties.title}`,e.id=`farm-listing-item-${a.properties.id}`,e.addEventListener("click",({target:e})=>{e.id==`farm-listing-item-${a.properties.id}`&&(removeActiveClass(),sidePanel.classList.remove("openListing"),e.classList.add("active"),document.getElementById(`${a.properties.id}`).classList.add("active"),jumpTo(a),createPopUp(a))}),farmListingContainer.appendChild(e),addMarker(a,t)}}function mapFitBounds(e,t){var o=new mapboxgl.LngLatBounds;e.forEach(e=>{o.extend(e.geometry.coordinates)}),map.fitBounds(o,{padding:t})}function createPopUp(e){removeOpenPopups();new mapboxgl.Popup({offset:45}).setLngLat(e.geometry.coordinates).setHTML(`\n      <h3>${e.properties.title}</h3>\n      <div class="flex items-center" style="padding: 15px;">\n        <div class="description">\n          <div class="location">${e.properties.location}</div>\n          <div class="crop">Crop: <br> <b>${e.properties.crop}</b></div>\n          <div class="acres">Acres: <br> <b>${e.properties.grossacres}</b></div>\n        </div>\n        <img class="image" width="170" height="130" src=${e.properties.image} />\n      </div>\n    `).on("close",function(){removeActiveClass()}).addTo(map)}mapboxgl.accessToken="pk.eyJ1IjoidHVuZ3N0ZW5hZHZlcnRpc2luZyIsImEiOiJja2dsZGNyZjAwMXltMnNqbzNrYTIwb210In0.PFX4yyFsRcpGMyQJV3uOkA";var farms={type:"FeatureCollection",features:[{type:"Feature",properties:{id:"marker-ipmpomy50",title:"Alborz Farms",grossacres:"320",location:"Kern County",crop:"Pistachios",pistachios:!0,almonds:!1,walnuts:!1,image:"images/alborz.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-119.366455,35.365535],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmqi6op9",title:"Dixieland Farms",grossacres:"1167",location:"Solano County",crop:"Almonds/Walnuts",pistachios:!1,almonds:!0,walnuts:!0,image:"images/dixieland.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-121.873769,38.457311],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmqpjl2c",title:"Farazad Ranch",grossacres:"1815",location:"Merced County",crop:"Pistachios",pistachios:!0,almonds:!1,walnuts:!1,image:"images/farazad.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-120.564433,37.156605],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmqrew2d",title:"Karun Farm",grossacres:"800",location:"Fresno County",crop:"Pistachio/Almonds",pistachios:!0,almonds:!0,walnuts:!1,image:"images/karun.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-120.022675,36.16003],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmqe9ej8",title:"Kingman Ranch",grossacres:"2198",location:"Kern County",crop:"Pistachios",pistachios:!0,almonds:!1,walnuts:!1,image:"images/kingman.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-114.058727,35.501153],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmq7elp5",title:"Lone Palm Ranch",grossacres:"643",location:"Kern County",crop:"Pistachios",pistachios:!0,almonds:!1,walnuts:!1,image:"images/lone-palm.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-119.491536,36.029105],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmqn2v4b",title:"Mersal Farm",grossacres:"1220",location:"Merced County",crop:"Almonds",pistachios:!1,almonds:!0,walnuts:!1,image:"images/mersal.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-120.506619,37.251277],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmqtg9ae",title:"Meymand Farm",grossacres:"321",location:"Fresno/Kings Counties",crop:"Pistachios",pistachios:!0,almonds:!1,walnuts:!1,image:"images/meymand.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-120.026694,36.130877],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmqx4i5g",title:"Nilufarm",grossacres:"743",location:"Madera County",crop:"Pistachios",pistachios:!0,almonds:!1,walnuts:!1,image:"images/nilufarm.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-120.249455,36.800077],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmq12ly2",title:"Paariz Farm",grossacres:"961",location:"Kern County",crop:"Pistachios",pistachios:!0,almonds:!1,walnuts:!1,image:"images/paariz.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-119.446075,35.712147],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmq4e1t3",title:"Payvand Farms",grossacres:"640",location:"Kern County",crop:"Pistachios",pistachios:!0,almonds:!1,walnuts:!1,image:"images/payvand.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-119.4028444,35.7397528],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmq8o636",title:"Raaviz Farms",grossacres:"432",location:"Kern County",crop:"Pistachios",pistachios:!0,almonds:!1,walnuts:!1,image:"images/raaviz.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-119.392525,35.370152],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmq66xg4",title:"Saty Farm",grossacres:"235",location:"Kern County",crop:"Pistachios",pistachios:!0,almonds:!1,walnuts:!1,image:"images/saty.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-119.430677,35.692361],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmqv05zf",title:"Seanaria Farms",grossacres:"2075",location:"Madera County",crop:"Pistachio/Almonds",pistachios:!0,almonds:!0,walnuts:!1,image:"images/seanaria.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-120.291225,36.858372],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmpyg871",title:"Shasti Farms",grossacres:"914",location:"Kern County",crop:"Pistachios",pistachios:!0,almonds:!1,walnuts:!1,image:"images/shasti.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-119.591388,35.628891],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmql5s8a",title:"Tranquility Orchards",grossacres:"1080",location:"Solano County",crop:"Almonds/Walnuts",pistachios:!1,almonds:!0,walnuts:!0,image:"images/tranquility.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-121.866016,38.426855],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmqgg538",title:"Vista Orchards North",grossacres:"499",location:"Colusa County",crop:"Walnuts",pistachios:!1,almonds:!1,walnuts:!0,image:"images/vista-north.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-121.988997,39.446133],type:"Point"}},{type:"Feature",properties:{id:"marker-ipmqe9ej7",title:"Vista Orchards South",grossacres:"396",location:"Kern County",crop:"Pistachios",pistachios:!0,almonds:!1,walnuts:!1,image:"images/vista-south.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-118.806777,35.039244],type:"Point"}},{type:"Feature",properties:{id:"yucca-marker",title:"Yucca",crop:"Pistachios",grossacres:"1905",location:"Kern County",pistachios:!0,almonds:!1,walnuts:!1,image:"images/yucca.webp","marker-color":"#1087bf","marker-symbol":""},geometry:{coordinates:[-113.915557,35.33682],type:"Point"}}]};farms.features.forEach((e,t)=>e.properties.index=t);const farmListingContainer=document.querySelector(".farms-listing"),sidePanel=document.querySelector(".sidepanel"),mobileListingToggle=document.querySelector("#mobile-listing-toggle"),map=new mapboxgl.Map({container:"map",style:"mapbox://styles/tungstenadvertising/ckgs7i7zr03o819o0apqv1bhu",center:[244,35],zoom:4,scrollZoom:!1}),xsMobile=window.matchMedia("(max-width: 420px)").matches,mobile=window.matchMedia("(min-width: 421px) and (max-width: 575px)").matches,tablet=window.matchMedia("(min-width: 576px) and (max-width: 992px)").matches,desktop=window.matchMedia("(min-width: 993px)").matches;map.on("load",e=>{let t;xsMobile?t=4.5:mobile?t=5:tablet?t=5:desktop&&(t=6),map.easeTo({center:[242,36],zoom:t,duration:3e3}),map.addControl(nav,"bottom-right"),buildLocationList(farms.features,!0)});const nav=new mapboxgl.NavigationControl({showCompass:!1}),resetMap=document.querySelector("#reset_map");resetMap.addEventListener("click",e=>{e.preventDefault(),mapFitBounds(farms.features,70),closePopup(),removeActiveClass()});const filterItems=document.querySelectorAll(".filter-item"),allOrhards=filterItems[0];filterItems.forEach(e=>{e.addEventListener("click",e=>{if(e.preventDefault(),e.target.classList.contains("active"))return;closePopup(),filterItems.forEach(e=>e.classList.remove("active")),e.target.classList.add("active");let t,o=e.target.dataset.filter;if("all"==o)return buildLocationList(farms.features,!1),t=desktop?300:30,console.log(t),void mapFitBounds(farms.features,t);"pistachios"==o&&(t=desktop?300:50,console.log(t)),"walnuts"==o&&(t=desktop?200:100,console.log(t)),"almonds"==o&&(t=desktop?200:100,console.log(t));let a={type:"FeatureCollection",features:farms.features.filter(e=>e.properties[o])};buildLocationList(a.features,!1),mapFitBounds(a.features,t)})}),mobileListingToggle.addEventListener("click",({target:e})=>{sidePanel.classList.toggle("openListing")});